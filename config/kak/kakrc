define-command -docstring 'Toggle UI elements' -params 1.. \
toggle-highlighter %{
    try %{
        add-highlighter %arg{@}
    } catch %{
        remove-highlighter %arg{1}
    }
}
define-command -docstring 'Toggle options' -params 1.. \
toggle-option %{
    try %{
        evaluate-commands "evaluate-commands %%sh{ [ -z ""$kak_opt_%arg{2}"" ] && printf nop || printf fail }"
        set-option %arg{@}
    } catch %{
        set-option %arg{1} %arg{2} ''
    }
}
declare-user-mode decoration
map -docstring "modeline" global decoration m %{: toggle-option window modelinefmt '%val{bufname} %val{cursor_line}:%val{cursor_char_column} {{context_info}} {{mode_info}} - %val{client}@[%val{session}]'<ret>}
map -docstring "line numbers" global decoration n %{: toggle-highlighter window/nl number-lines<ret>}
map -docstring "relative line numbers" global decoration N %{: toggle-highlighter window/nlr number-lines -relative<ret>}
map -docstring "80 column" global decoration c %{: toggle-highlighter window/col column 80 ,bright-black@WrapMarker<ret>}
map -docstring "120 column" global decoration C %{: toggle-highlighter window/col column 120 ,bright-black@WrapMarker<ret>}
map -docstring "decoration mode" global user v ': enter-user-mode decoration<ret>'

set-option global indentwidth 4
define-command -docstring 'Rename the current session to given name, and try to daemonize them' -params 1 \
try-daemonize %{
    try %{ daemonize-session }
    rename-session %arg{1}
}
map -docstring 'Rename session' global user z ': prompt "Session Name:" %{ try-daemonize %val{text} } <ret>'

hook global WinSetOption filetype=(clojure|lisp|picolisp|racket|scheme|haskell|markdown|asciidoc) %{
    set window indentwidth 2
    map window insert <tab> <space><space>
}

hook global WinSetOption filetype=(clojure|lisp|picolisp|racket|scheme) %{
    source "%val{config}/rc/parinfer.kak"
    map -docstring 'Toggle parinfer mode' window user p ': parinfer-toggle-mode<ret>'
}

# Search functions shouldn't flash the screen
map global normal / ": set-register / ''<ret>/"
map global normal <a-/> ": set-register / ''<ret><a-/>"

hook global WinSetOption filetype=xiki %{
    map window normal <ret> 'x<a-:><a-;>: xiki<ret>;'
    map window normal <a-ret> 'x: xiki-execute -fifo<ret>'
    source "%val{config}/rc/ansi.kak"
}

# Scratch buffer should use Xiki!
hook global WinCreate '\*scratch\*' %{
    set-option window filetype xiki
}

set-option -add global ui_options 'mosham_fonts=Iosevka,Manjari' 'mosham_font_size=16'
