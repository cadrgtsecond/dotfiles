hook global WinSetOption filetype=(rust|zig) %{
    eval %sh{ kak-lsp }
}

define-command -docstring "Enable lsp" enable-lsp %{
    set-option window lsp_language_id %opt{filetype}
    lsp-enable-window

    # Disable LSP Completion
    set-option window completers 'filename' 'word=all'

    # Disable clutter
    lsp-diagnostic-lines-disable window
    lsp-inline-diagnostics-disable window

    map -docstring "Enter LSP Mode" window user <space> ": enter-user-mode lsp<ret>"
}

hook global WinSetOption filetype=zig %{
    set-option window lsp_servers %{
        [zls]
        root_globs = ["build.zig"]
        settings_section = "zls"
        [zls.settings.zls]
        enable_snippets = false
        enable_argument_placeholders = false
    }
}

set-option global indentwidth 4
define-command -docstring "Rename the current session to given name, and try to daemonize them" -params 1 \
try-daemonize %{
    try %{ daemonize-session }
    rename-session %arg{1}
}
map -docstring "Rename session" global user z ': prompt "Session Name:" %{ try-daemonize %val{text} } <ret>'

hook global WinSetOption filetype=(clojure|lisp|picolisp|racket|scheme|haskell|markdown|asciidoc) %{
    set window indentwidth 2
    map window insert <tab> <space><space>
}

hook global WinSetOption filetype=(clojure|lisp|picolisp|racket|scheme) %{
    parinfer-enable-window
    map -docstring "Toggle parinfer mode" window user "p" ": parinfer-toggle-mode<ret>"
}

# Search functions shouldn't flash the screen
map global normal '/' ': set-register / ""<ret>/'
map global normal '<a-/>' ': set-register / ""<ret><a-/>'
